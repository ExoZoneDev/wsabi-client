!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var r=n(1);e.WsabiSocket=r.WsabiSocket;var i=n(3);e.WsabiClient=i.WsabiClient},function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=n(2),s=function(t){function e(e){t.call(this),this.url=e,this.messageId=0,this.waiting={}}return r(e,t),e.prototype.connect=function(){var t=this;this._socket=new e.WebSocket(this.url+"/socket.io/?transport=websocket&__sails_io_sdk_version=0.11.0"),this._socket.addEventListener("open",function(){t.ping()}),this._socket.addEventListener("message",function(e){return t._handleSocketMessage(e.data)}),this._socket.addEventListener("close",function(t){console.log("Socket closed:",t)}),this._socket.addEventListener("error",function(t){console.log("ERROR:",t)})},e.prototype.close=function(){this._socket.close()},e.prototype._handleSocketMessage=function(t){var n=e.messageRegex.exec(t);switch(parseInt(n[1])){case 0:this.emit("open");break;case 1:this.close();break;case 3:this.emit("pong");break;case 4:var r,i=parseInt(n[2][0]),s=parseInt(n[2].slice(1));try{r=JSON.parse(n[3])}catch(o){r=n[3]}this._handleMessagePacket(i,s,r);break;default:console.warn("Unsupported packet id",n[1])}},e.prototype._handleMessagePacket=function(t,e,n){switch(t){case 2:this.messageId=Math.max(this.messageId,e+1),Array.isArray(n)&&2==n.length?this.emit(n[0],n[1]):this.emit("message",n);break;case 3:this.messageId=Math.max(this.messageId,e+1),null!=this.waiting[e]?(this.waiting[e].call(this,n),delete this.waiting[e]):this.emit("response",{id:e,data:n})}},e.prototype.ping=function(){var t=this;this._socket.readyState===e.WebSocket.OPEN&&(this._socket.send("2"),setTimeout(function(){t.ping()},5e4))},e.prototype.send=function(t,e){var n=++this.messageId;null!=e&&this.wait(n,e),this._socket.send("42"+n+JSON.stringify(t))},e.prototype.wait=function(t,e){this.waiting[t]=e},e.WebSocket="function"==typeof WebSocket?WebSocket:void 0,e.messageRegex=/(\d)(\d*)(.*)/,e}(i.EventEmitter);e.WsabiSocket=s},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!i(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,i,c,u,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:c=Array.prototype.slice.call(arguments,1),n.apply(this,c)}else if(s(n))for(c=Array.prototype.slice.call(arguments,1),a=n.slice(),i=a.length,u=0;i>u;u++)a[u].apply(this,c);return!0},n.prototype.addListener=function(t,e){var i;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,i,o,c;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],o=n.length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(c=o;c-- >0;)if(n[c]===e||n[c].listener&&n[c].listener===e){i=c;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){var r=n(1),i=n(4);n(14);var s=function(){function t(t,e){void 0===e&&(e=!0),this.liveUrl="/live",this.logging=!0,this.subscriptions={},this.socket=new r.WsabiSocket(t),e&&this.connect()}return t.prototype.connect=function(){this.socket.connect()},t.prototype.request=function(e,n,r,i){var s=this;return void 0===r&&(r={}),void 0===i&&(i={}),new t.Promise(function(t){s.socket.send([e,{method:e,headers:i,url:n,data:r}],t)}).then(function(t){return t[0]})},t.prototype.get=function(t,e){return void 0===e&&(e={}),this.request("get",t).then(function(t){return t.body})},t.prototype.post=function(t,e,n){return void 0===n&&(n={}),this.request("post",t,e).then(function(t){return t.body})},t.prototype.put=function(t,e,n){return void 0===n&&(n={}),this.request("put",t,e).then(function(t){return t.body})},t.prototype["delete"]=function(t,e,n){return void 0===n&&(n={}),this.request("delete",t,e).then(function(t){return t.body})},t.prototype.live=function(t){var e=this;return this.subscriptions.hasOwnProperty(t)||(this.subscriptions[t]=i.Observable.fromEvent(this.socket,t),this.put(this.liveUrl,{slug:t}).then(function(n){e.logging&&console.log("[Wsabi]","["+t+"]",n.message||n)})),this.subscriptions[t]},t.Promise="function"==typeof Promise?Promise:void 0,t}();e.WsabiClient=s},function(t,e,n){var r=n(5),i=n(12),s=n(11),o=n(10),c=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype[s.SymbolShim.observable]=function(){return this},t.prototype.subscribe=function(t,e,n){var i;if(t&&"object"==typeof t)i=t instanceof r.Subscriber?t:t[o.rxSubscriber]?t[o.rxSubscriber]():new r.Subscriber(t);else{var s=t;i=r.Subscriber.create(s,e,n)}return i.add(this._subscribe(i)),i},t.prototype.forEach=function(t,e,n){if(n||(i.root.Rx&&i.root.Rx.config&&i.root.Rx.config.Promise?n=i.root.Rx.config.Promise:i.root.Promise&&(n=i.root.Promise)),!n)throw new Error("no Promise impl found");var r;e?(r=function o(t){var e=o,n=e.thisArg,r=e.next;return r.call(n,t)},r.thisArg=e,r.next=t):r=t;var s=function c(t,e){var n=c,r=n.source,i=n.nextHandler;r.subscribe(i,e,t)};return s.source=this,s.nextHandler=r,new n(s)},t.prototype._subscribe=function(t){return this.source._subscribe(this.operator.call(t))},t.create=function(e){return new t(e)},t}();e.Observable=c},function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=n(6),s=n(7),o=n(8),c=n(9),u=n(10),a=function(t){function e(n){if(t.call(this),this.destination=n,this._isUnsubscribed=!1,this.destination){var r=n._subscription;r?this._subscription=r:n instanceof e&&(this._subscription=n)}}return r(e,t),e.prototype[u.rxSubscriber]=function(){return this},Object.defineProperty(e.prototype,"isUnsubscribed",{get:function(){var t=this._subscription;return t?this._isUnsubscribed||t.isUnsubscribed:this._isUnsubscribed},set:function(t){var e=this._subscription;e?e.isUnsubscribed=Boolean(t):this._isUnsubscribed=Boolean(t)},enumerable:!0,configurable:!0}),e.create=function(t,n,r){var c=new e;return c._next="function"==typeof t&&o.tryOrOnError(t)||i.noop,c._error="function"==typeof n&&n||s.throwError,c._complete="function"==typeof r&&r||i.noop,c},e.prototype.add=function(e){var n=this._subscription;n?n.add(e):t.prototype.add.call(this,e)},e.prototype.remove=function(e){this._subscription?this._subscription.remove(e):t.prototype.remove.call(this,e)},e.prototype.unsubscribe=function(){this._isUnsubscribed||(this._subscription?this._isUnsubscribed=!0:t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){var e=this.destination;e.next&&e.next(t)},e.prototype._error=function(t){var e=this.destination;e.error&&e.error(t)},e.prototype._complete=function(){var t=this.destination;t.complete&&t.complete()},e.prototype.next=function(t){this.isUnsubscribed||this._next(t)},e.prototype.error=function(t){this.isUnsubscribed||(this._error(t),this.unsubscribe())},e.prototype.complete=function(){this.isUnsubscribed||(this._complete(),this.unsubscribe())},e}(c.Subscription);e.Subscriber=a},function(t,e){function n(){}e.noop=n},function(t,e){function n(t){throw t}e.throwError=n},function(t,e){function n(t){function e(){try{e.target.apply(this,arguments)}catch(t){this.error(t)}}return e.target=t,e}e.tryOrOnError=n},function(t,e,n){var r=n(6),i=function(){function t(t){this.isUnsubscribed=!1,t&&(this._unsubscribe=t)}return t.prototype._unsubscribe=function(){r.noop()},t.prototype.unsubscribe=function(){if(!this.isUnsubscribed){this.isUnsubscribed=!0;var t=this._unsubscribe,e=this._subscriptions;if(this._subscriptions=void 0,t&&t.call(this),null!=e)for(var n=-1,r=e.length;++n<r;)e[n].unsubscribe()}},t.prototype.add=function(e){if(e&&e!==this&&e!==t.EMPTY){var n=e;switch(typeof e){case"function":n=new t(e);case"object":if(n.isUnsubscribed||"function"!=typeof n.unsubscribe)break;if(this.isUnsubscribed)n.unsubscribe();else{var r=this._subscriptions||(this._subscriptions=[]);r.push(n)}break;default:throw new Error("Unrecognized subscription "+e+" added to Subscription.")}}},t.prototype.remove=function(e){if(null!=e&&e!==this&&e!==t.EMPTY){var n=this._subscriptions;if(n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}},t.EMPTY=function(t){return t.isUnsubscribed=!0,t}(new t),t}();e.Subscription=i},function(t,e,n){var r=n(11);e.rxSubscriber=r.SymbolShim["for"]("rxSubscriber")},function(t,e,n){function r(t){var e=s(t);return c(e,t),u(e),i(e),e}function i(t){t["for"]||(t["for"]=o)}function s(t){return t.Symbol||(t.Symbol=function(t){return"@@Symbol("+t+"):"+h++}),t.Symbol}function o(t){return"@@"+t}function c(t,e){if(!t.iterator)if("function"==typeof t["for"])t.iterator=t["for"]("iterator");else if(e.Set&&"function"==typeof(new e.Set)["@@iterator"])t.iterator="@@iterator";else if(e.Map)for(var n=Object.getOwnPropertyNames(e.Map.prototype),r=0;r<n.length;++r){var i=n[r];if("entries"!==i&&"size"!==i&&e.Map.prototype[i]===e.Map.prototype.entries){t.iterator=i;break}}else t.iterator="@@iterator"}function u(t){t.observable||("function"==typeof t["for"]?t.observable=t["for"]("observable"):t.observable="@@observable")}var a=n(12);e.polyfillSymbol=r,e.ensureFor=i;var h=0;e.ensureSymbol=s,e.symbolForPolyfill=o,e.ensureIterator=c,e.ensureObservable=u,e.SymbolShim=r(a.root)},function(t,e,n){(function(t,n){var r={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};e.root=r[typeof self]&&self||r[typeof window]&&window;var i=(r[typeof e]&&e&&!e.nodeType&&e,r[typeof t]&&t&&!t.nodeType&&t,r[typeof n]&&n);!i||i.global!==i&&i.window!==i||(e.root=i)}).call(e,n(13)(t),function(){return this}())},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e,n){var r=n(4),i=n(15);r.Observable.fromEvent=i.FromEventObservable.create},function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=n(4),s=n(16),o=n(17),c=n(9),u=function(t){function e(e,n,r){t.call(this),this.sourceObj=e,this.eventName=n,this.selector=r}return r(e,t),e.create=function(t,n,r){return new e(t,n,r)},e.setupSubscription=function(t,n,r,i){var s,o=t.toString();if("[object NodeList]"===o||"[object HTMLCollection]"===o)for(var u=0,a=t.length;a>u;u++)e.setupSubscription(t[u],n,r,i);else"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener?(t.addEventListener(n,r),s=function(){return t.removeEventListener(n,r)}):"function"==typeof t.on&&"function"==typeof t.off?(t.on(n,r),s=function(){return t.off(n,r)}):"function"==typeof t.addListener&&"function"==typeof t.removeListener&&(t.addListener(n,r),s=function(){return t.removeListener(n,r)});i.add(new c.Subscription(s))},e.prototype._subscribe=function(t){var n=this.sourceObj,r=this.eventName,i=this.selector,c=i?function(e){var n=s.tryCatch(i)(e);n===o.errorObject?t.error(n.e):t.next(n)}:function(e){return t.next(e)};e.setupSubscription(n,r,c,t)},e}(i.Observable);e.FromEventObservable=u},function(t,e,n){function r(){try{return s.apply(this,arguments)}catch(t){return o.errorObject.e=t,o.errorObject}}function i(t){return s=t,r}var s,o=n(17);e.tryCatch=i},function(t,e){e.errorObject={e:{}}}]);
//# sourceMappingURL=wsabi-client.min.js.map