!function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";var n=r(1);e.WsabiSocket=n.WsabiSocket;var i=r(3);e.WsabiClient=i.WsabiClient},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},i=r(2),s=function(t){function e(e){t.call(this),this.url=e,this.messageId=0,this.waiting={},this.reconnecting=!1}return n(e,t),e.prototype.connect=function(){var t=this;this._socket=new e.WebSocket(this.url+"/socket.io/?transport=websocket&__sails_io_sdk_version=0.11.0"),this._socket.addEventListener("open",function(){t.ping()}),this._socket.addEventListener("message",function(e){return t._handleSocketMessage(e.data)}),this._socket.addEventListener("close",function(e){t.reconnecting=!0,setTimeout(function(){t.connect()},1e4)}),this._socket.addEventListener("error",function(t){console.log("ERROR:",t)})},e.prototype.close=function(){this._socket.close()},e.prototype._handleSocketMessage=function(t){var r=e.messageRegex.exec(t);switch(parseInt(r[1])){case 0:this.reconnecting&&(this.reconnecting=!1,this.emit("reopen")),this.emit("open");break;case 1:this.close();break;case 3:this.emit("pong");break;case 4:var n=parseInt(r[2][0]),i=parseInt(r[2].slice(1)),s=void 0;try{s=JSON.parse(r[3])}catch(o){s=r[3]}this._handleMessagePacket(n,i,s);break;default:console.warn("Unsupported packet id",r[1])}},e.prototype._handleMessagePacket=function(t,e,r){switch(t){case 2:Array.isArray(r)&&2==r.length?this.emit(r[0],r[1]):this.emit("message",r);break;case 3:null!=this.waiting[e]?(this.waiting[e].call(this,r),delete this.waiting[e]):this.emit("response",{id:e,data:r})}},e.prototype.ping=function(){var t=this;this._socket.readyState===e.WebSocket.OPEN&&(this._socket.send("2"),setTimeout(function(){t.ping()},5e4))},e.prototype.send=function(t,e){var r=++this.messageId;null!=e&&this.wait(r,e),this._socket.send("42"+r+JSON.stringify(t))},e.prototype.wait=function(t,e){this.waiting[t]=e},e.prototype.isConnected=function(){return this._socket.readyState===this._socket.OPEN},e.WebSocket="function"==typeof WebSocket?WebSocket:void 0,e.messageRegex=/(\d)(\d*)(.*)/,e}(i.EventEmitter);e.WsabiSocket=s},function(t,e){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function i(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!i(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,r,i,c,u,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(r=this._events[t],o(r))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:c=Array.prototype.slice.call(arguments,1),r.apply(this,c)}else if(s(r))for(c=Array.prototype.slice.call(arguments,1),h=r.slice(),i=h.length,u=0;i>u;u++)h[u].apply(this,c);return!0},r.prototype.addListener=function(t,e){var i;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(i=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function r(){this.removeListener(t,r),i||(i=!0,e.apply(this,arguments))}if(!n(e))throw TypeError("listener must be a function");var i=!1;return r.listener=e,this.on(t,r),this},r.prototype.removeListener=function(t,e){var r,i,o,c;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(r=this._events[t],o=r.length,i=-1,r===e||n(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(r)){for(c=o;c-- >0;)if(r[c]===e||r[c].listener&&r[c].listener===e){i=c;break}if(0>i)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[t],n(r))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(n(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,r){"use strict";var n=r(1),i=r(4);r(19);var s=function(){function t(t,e){var r=this;void 0===e&&(e=!0),this.liveUrl="/live",this.subscriptions={},this.socket=new n.WsabiSocket(t),this.socket.on("reopen",function(){for(var t=Object.keys(r.subscriptions),e=0,n=t.length;n>e;e++)r.put(r.liveUrl,{slug:t[e]})}),e&&this.connect()}return Object.defineProperty(t,"WebSocket",{set:function(t){n.WsabiSocket.WebSocket=t},enumerable:!0,configurable:!0}),t.prototype.connect=function(){this.socket.connect()},t.prototype.request=function(e,r,n,i){var s=this;return void 0===n&&(n={}),void 0===i&&(i={}),new t.Promise(function(t,o){s.socket.isConnected()?s.socket.send([e,{method:e,headers:i,url:r,data:n}],function(e){200!=e[0].statusCode?o(e[0]):t(e)}):s.socket.once("open",function(){s.socket.send([e,{method:e,headers:i,url:r,data:n}],function(e){200!=e[0].statusCode?o(e[0]):t(e)})})}).then(function(t){return t[0]})},t.prototype.get=function(t,e){return void 0===e&&(e={}),this.request("get",t,{},e).then(function(t){return t.body})},t.prototype.post=function(t,e,r){return void 0===r&&(r={}),this.request("post",t,e,r).then(function(t){return t.body})},t.prototype.put=function(t,e,r){return void 0===r&&(r={}),this.request("put",t,e,r).then(function(t){return t.body})},t.prototype["delete"]=function(t,e,r){return void 0===r&&(r={}),this.request("delete",t,e,r).then(function(t){return t.body})},t.prototype.live=function(t,e){var r=this;return void 0===e&&(e=!1),null==this.subscriptions[t]&&(this.subscriptions[t]=0),i.Observable.create(function(n){var i=function(t){return n.next(t)};return 0===r.subscriptions[t]?r.put(r.liveUrl,{slug:t}).then(function(s){e&&n.next({isClient:!0,message:"subscribed",data:s}),r.subscriptions[t]++,r.socket.on(t,i)})["catch"](function(t){return n.error(t)}):(e&&n.next({isClient:!0,message:"resubscribed"}),r.subscriptions[t]++,r.socket.on(t,i)),function(){r.subscriptions[t]--,r.socket.removeListener(t,i),0===r.subscriptions[t]&&r["delete"](r.liveUrl,{slug:t})}})},t.Promise="function"==typeof Promise?Promise:void 0,t}();e.WsabiClient=s},function(t,e,r){"use strict";var n=r(5),i=r(7),s=r(8),o=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=s.toSubscriber(t,e,r);if(i.add(n?n.call(i,this):this._subscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype.forEach=function(t,e){var r=this;if(e||(n.root.Rx&&n.root.Rx.config&&n.root.Rx.config.Promise?e=n.root.Rx.config.Promise:n.root.Promise&&(e=n.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,n){var i=r.subscribe(function(e){if(i)try{t(e)}catch(r){n(r),i.unsubscribe()}else t(e)},n,e)})},t.prototype._subscribe=function(t){return this.source.subscribe(t)},t.prototype[i.$$observable]=function(){return this},t.create=function(e){return new t(e)},t}();e.Observable=o},function(t,e,r){(function(t,r){"use strict";var n={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};e.root=n[typeof self]&&self||n[typeof window]&&window;var i=(n[typeof e]&&e&&!e.nodeType&&e,n[typeof t]&&t&&!t.nodeType&&t,n[typeof r]&&r);!i||i.global!==i&&i.window!==i||(e.root=i)}).call(e,r(6)(t),function(){return this}())},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e,r){"use strict";var n=r(5),i=n.root.Symbol;"function"==typeof i?i.observable?e.$$observable=i.observable:("function"==typeof i["for"]?e.$$observable=i["for"]("observable"):e.$$observable=i("observable"),i.observable=e.$$observable):e.$$observable="@@observable"},function(t,e,r){"use strict";function n(t,e,r){if(t&&"object"==typeof t){if(t instanceof i.Subscriber)return t;if("function"==typeof t[s.$$rxSubscriber])return t[s.$$rxSubscriber]()}return new i.Subscriber(t,e,r)}var i=r(9),s=r(17);e.toSubscriber=n},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},i=r(10),s=r(11),o=r(17),c=r(18),u=function(t){function e(r,n,i){switch(t.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=c.empty;break;case 1:if(!r){this.destination=c.empty;break}if("object"==typeof r){r instanceof e?(this.destination=r,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new h(this,r));break}default:this.syncErrorThrowable=!0,this.destination=new h(this,r,n,i)}}return n(e,t),e.create=function(t,r,n){var i=new e(t,r,n);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.isUnsubscribed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype[o.$$rxSubscriber]=function(){return this},e}(s.Subscription);e.Subscriber=u;var h=function(t){function e(e,r,n,s){t.call(this),this._parent=e;var o,c=this;i.isFunction(r)?o=r:r&&(c=r,o=r.next,n=r.error,s=r.complete,i.isFunction(c.unsubscribe)&&this.add(c.unsubscribe.bind(c)),c.unsubscribe=this.unsubscribe.bind(this)),this._context=c,this._next=o,this._error=n,this._complete=s}return n(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parent;e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parent;if(this._error)e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else{if(!e.syncErrorThrowable)throw this.unsubscribe(),t;e.syncErrorValue=t,e.syncErrorThrown=!0,this.unsubscribe()}}},e.prototype.complete=function(){if(!this.isStopped){var t=this._parent;this._complete?t.syncErrorThrowable?(this.__tryOrSetError(t,this._complete),this.unsubscribe()):(this.__tryOrUnsub(this._complete),this.unsubscribe()):this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(r){throw this.unsubscribe(),r}},e.prototype.__tryOrSetError=function(t,e,r){try{e.call(this._context,r)}catch(n){return t.syncErrorValue=n,t.syncErrorThrown=!0,!0}return!1},e.prototype._unsubscribe=function(){var t=this._parent;this._context=null,this._parent=null,t.unsubscribe()},e}(u)},function(t,e){"use strict";function r(t){return"function"==typeof t}e.isFunction=r},function(t,e,r){"use strict";var n=r(12),i=r(13),s=r(10),o=r(14),c=r(15),u=r(16),h=function(){function t(t){this.isUnsubscribed=!1,t&&(this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.isUnsubscribed){this.isUnsubscribed=!0;var r=this,h=r._unsubscribe,a=r._subscriptions;if(this._subscriptions=null,s.isFunction(h)){var f=o.tryCatch(h).call(this);f===c.errorObject&&(e=!0,(t=t||[]).push(c.errorObject.e))}if(n.isArray(a))for(var p=-1,b=a.length;++p<b;){var l=a[p];if(i.isObject(l)){var f=o.tryCatch(l.unsubscribe).call(l);if(f===c.errorObject){e=!0,t=t||[];var v=c.errorObject.e;v instanceof u.UnsubscriptionError?t=t.concat(v.errors):t.push(v)}}}if(e)throw new u.UnsubscriptionError(t)}},t.prototype.add=function(e){if(e&&e!==this&&e!==t.EMPTY){var r=e;switch(typeof e){case"function":r=new t(e);case"object":if(r.isUnsubscribed||"function"!=typeof r.unsubscribe)break;this.isUnsubscribed?r.unsubscribe():(this._subscriptions||(this._subscriptions=[])).push(r);break;default:throw new Error("Unrecognized teardown "+e+" added to Subscription.")}return r}},t.prototype.remove=function(e){if(null!=e&&e!==this&&e!==t.EMPTY){var r=this._subscriptions;if(r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}},t.EMPTY=function(t){return t.isUnsubscribed=!0,t}(new t),t}();e.Subscription=h},function(t,e){"use strict";e.isArray=Array.isArray||function(t){return t&&"number"==typeof t.length}},function(t,e){"use strict";function r(t){return null!=t&&"object"==typeof t}e.isObject=r},function(t,e,r){"use strict";function n(){try{return s.apply(this,arguments)}catch(t){return o.errorObject.e=t,o.errorObject}}function i(t){return s=t,n}var s,o=r(15);e.tryCatch=i},function(t,e){"use strict";e.errorObject={e:{}}},function(t,e){"use strict";var r=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},n=function(t){function e(e){t.call(this),this.errors=e,this.name="UnsubscriptionError",this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n"):""}return r(e,t),e}(Error);e.UnsubscriptionError=n},function(t,e,r){"use strict";var n=r(5),i=n.root.Symbol;e.$$rxSubscriber="function"==typeof i&&"function"==typeof i["for"]?i["for"]("rxSubscriber"):"@@rxSubscriber"},function(t,e){"use strict";e.empty={isUnsubscribed:!0,next:function(t){},error:function(t){throw t},complete:function(){}}},function(t,e,r){"use strict";var n=r(4),i=r(20);n.Observable.fromEvent=i.fromEvent},function(t,e,r){"use strict";var n=r(21);e.fromEvent=n.FromEventObservable.create},function(t,e,r){"use strict";function n(t){return!!t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}function i(t){return!!t&&"function"==typeof t.on&&"function"==typeof t.off}function s(t){return!!t&&"[object NodeList]"===t.toString()}function o(t){return!!t&&"[object HTMLCollection]"===t.toString()}function c(t){return!!t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}var u=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},h=r(4),a=r(14),f=r(15),p=r(11),b=function(t){function e(e,r,n){t.call(this),this.sourceObj=e,this.eventName=r,this.selector=n}return u(e,t),e.create=function(t,r,n){return new e(t,r,n)},e.setupSubscription=function(t,r,u,h){var a;if(s(t)||o(t))for(var f=0,b=t.length;b>f;f++)e.setupSubscription(t[f],r,u,h);else c(t)?(t.addEventListener(r,u),a=function(){return t.removeEventListener(r,u)}):i(t)?(t.on(r,u),a=function(){return t.off(r,u)}):n(t)&&(t.addListener(r,u),a=function(){return t.removeListener(r,u)});h.add(new p.Subscription(a))},e.prototype._subscribe=function(t){var r=this.sourceObj,n=this.eventName,i=this.selector,s=i?function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=a.tryCatch(i).apply(void 0,e);n===f.errorObject?t.error(f.errorObject.e):t.next(n)}:function(e){return t.next(e)};e.setupSubscription(r,n,s,t)},e}(h.Observable);e.FromEventObservable=b}]);
//# sourceMappingURL=wsabi-client.min.js.map